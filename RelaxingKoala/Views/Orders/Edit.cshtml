@model RelaxingKoala.Models.Orders.OrderViewModel

@{
    ViewData["Title"] = "Edit Order";
}

<h2>Edit Order</h2>

<form asp-action="Edit" method="post">
    <div class="form-group">
        <label asp-for="OrderTypeId" class="control-label"></label>
        <select asp-for="OrderTypeId" class="form-control" asp-items="ViewBag.OrderTypes" id="orderTypeSelect">
            @foreach (var item in ViewBag.OrderTypes)
            {
                <option value="@item.Value" selected="@(Model.OrderTypeId == (RelaxingKoala.Models.Orders.OrderType)int.Parse(item.Value) ? "selected" : null)">@item.Text</option>
            }
        </select>
    </div>
    <div class="form-group">
        <label asp-for="OrderStateId" class="control-label"></label>
        <select asp-for="OrderStateId" class="form-control" asp-items="ViewBag.OrderStates"></select>
    </div>
    <div class="form-group">
        <label asp-for="MenuItems" class="control-label"></label>
        <select asp-for="MenuItems" class="form-control" multiple="multiple">
            @foreach (var item in ViewBag.MenuItems)
            {
                <option value="@item.Value" selected="@(Model.MenuItems.Contains(int.Parse(item.Value)) ? "selected" : null)">@item.Text - @item.Cost</option>
            }
        </select>
    </div>
    <div class="form-group" id="tablesSection" style="display: @(Model.OrderTypeId == RelaxingKoala.Models.Orders.OrderType.DineIn ? "block" : "none");">
        <label asp-for="Tables" class="control-label"></label>
        <select asp-for="Tables" class="form-control" multiple="multiple">
            @foreach (var table in ViewBag.Tables)
            {
                <option value="@table.Id" selected="@(Model.Tables.Contains(table.Id) ? "selected" : null)">Table @table.Number</option>
            }
        </select>
    </div>
    <div class="form-group">
        <input type="submit" value="Save" class="btn btn-primary" />
    </div>
</form>

<div>
    <a asp-action="MyOrders" asp-route-userId="@Model.UserId">Back to List</a>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            $('#orderTypeSelect').change(function () {
                var selectedOrderType = $(this).val();
                var dineInOrderType = "2"; // Ensure this matches the DineIn enum value
                if (selectedOrderType == dineInOrderType) {
                    $('#tablesSection').show();
                } else {
                    $('#tablesSection').hide();
                }
            });
        });
    </script>
}
